library(tidyverse)
library(motifbreakR)
library(SNPlocs.Hsapiens.dbSNP144.GRCh37)
# BiocManager::install('BSgenome.Hsapiens.UCSC.hg19')
library(BSgenome)
library(BSgenome.Hsapiens.UCSC.hg19)
library(tidyverse)
library(motifbreakR)
library(SNPlocs.Hsapiens.dbSNP144.GRCh37)
# BiocManager::install('BSgenome.Hsapiens.UCSC.hg19')
library(BSgenome)
library(BSgenome.Hsapiens.UCSC.hg19)
variants <- snps.from.rsid(rsid = 'rs11634257',
dbSNP = SNPlocs.Hsapiens.dbSNP144.GRCh37,
search.genome = BSgenome.Hsapiens.UCSC.hg19)
variants <- snps.from.rsid(rsid = 'rs11634257',
dbSNP = SNPlocs.Hsapiens.dbSNP144.GRCh37,
search.genome = BSgenome.Hsapiens.UCSC.hg19)
results <- motifbreakR(snpList = variants, filterp = TRUE,
pwmList = hocomoco,
threshold = 1e-4,
method = "ic",
bkg = c(A=0.25, C=0.25, G=0.25, T=0.25),
BPPARAM = BiocParallel::bpparam())
# write.table( x = data.frame(results), file = paste0(save_dir,"motifBreakR_granges.txt"), sep="'\t", col.names=TRUE, row.names=FALSE, quote=FALSE )
View(results)
View(results)
for (snp in sort(unique(names(results)))){
snp_res <- results[names(results) %in% snp]
print('****')
num_hits = dim(data.frame(snp_res))[1]
print(paste(snp, num_hits, 'hits'))
}
# # snp_res <- calculatePvalue(snp_res)
# write.table(data.frame(snp_res), paste0(save_dir, snp, '_results.txt'),sep='\t')
# # head(lib_df[lib_df$Linked_SNP==snp,])
# num_strong_hits = dim(data.frame(snp_res) %>% filter(effect=='strong'))[1]
#
# print(paste(snp, num_strong_hits, 'strong hits'))
#
#
# if (num_strong_hits>0){
#    snps_with_strong_hits = c(snps_with_strong_hits, snp)
#   num_snps_with_strong_hits = num_snps_with_strong_hits+1
#   motifplot_file = paste0(save_dir, snp, "_motifplot.pdf")
#   if ((!file.exists(motifplot_file)) ){
#     if((num_strong_hits<20)){
#         pdf(motifplot_file)
#         plotMB(results = results, rsid = snp, effect = "strong")
#         dev.off()
#         print('made plot')
#     }
#     else{
#       print('too many motifs. skip plot making')
}
for (snp in sort(unique(names(results)))){
snp_res <- results[names(results) %in% snp]
snp_res <- calculatePvalue(snp_res)
snp_res <- data.frame(snp_res)
print('****')
num_hits = dim(snp_res)[1]
print(paste(snp, num_hits, 'hits'))
}
# write.table(snp_res, paste0(save_dir, snp, '_results.txt'),sep='\t')
# # head(lib_df[lib_df$Linked_SNP==snp,])
# num_strong_hits = dim(snp_res%>% filter(effect=='strong'))[1]
#
# print(paste(snp, num_strong_hits, 'strong hits'))
#
#
# if (num_strong_hits>0){
#    snps_with_strong_hits = c(snps_with_strong_hits, snp)
#   num_snps_with_strong_hits = num_snps_with_strong_hits+1
#   motifplot_file = paste0(save_dir, snp, "_motifplot.pdf")
#   if ((!file.exists(motifplot_file)) ){
#     if((num_strong_hits<20)){
#         pdf(motifplot_file)
#         plotMB(results = results, rsid = snp, effect = "strong")
#         dev.off()
#         print('made plot')
#     }
#     else{
#       print('too many motifs. skip plot making')
}
for (snp in sort(unique(names(results)))){
snp_res <- results[names(results) %in% snp]
snp_res <- calculatePvalue(snp_res)
snp_res <- data.frame(snp_res)
print('****')
num_hits = dim(snp_res)[1]
print(paste(snp, num_hits, 'hits'))
}
# write.table(snp_res, paste0(save_dir, snp, '_results.txt'),sep='\t')
# # head(lib_df[lib_df$Linked_SNP==snp,])
# num_strong_hits = dim(snp_res%>% filter(effect=='strong'))[1]
#
# print(paste(snp, num_strong_hits, 'strong hits'))
#
#
# if (num_strong_hits>0){
#    snps_with_strong_hits = c(snps_with_strong_hits, snp)
#   num_snps_with_strong_hits = num_snps_with_strong_hits+1
#   motifplot_file = paste0(save_dir, snp, "_motifplot.pdf")
#   if ((!file.exists(motifplot_file)) ){
#     if((num_strong_hits<20)){
#         pdf(motifplot_file)
#         plotMB(results = results, rsid = snp, effect = "strong")
#         dev.off()
#         print('made plot')
#     }
#     else{
#       print('too many motifs. skip plot making')
# }
View(snp_res)
View(snp_res)
?plotMB
for (snp in sort(unique(names(results)))){
snp_res <- results[names(results) %in% snp]
snp_res <- calculatePvalue(snp_res)
snp_res <- data.frame(snp_res)
print('****')
num_hits = dim(snp_res)[1]
print(paste(snp, num_hits, 'hits'))
write.table(snp_res,  paste0('../data/processed/snp_motifs/rs11634257_results.txt'),sep='\t')
motifplot_file = paste0("../data/processed/snp_motifs/rs11634257_motifplot.pdf")
pdf(motifplot_file)
plotMB(results = results, rsid = snp, effect = "strong")
dev.off()
}
# if (num_strong_hits>0){
#    snps_with_strong_hits = c(snps_with_strong_hits, snp)
#   num_snps_with_strong_hits = num_snps_with_strong_hits+1
#   motifplot_file = paste0(save_dir, snp, "_motifplot.pdf")
#   if ((!file.exists(motifplot_file)) ){
#     if((num_strong_hits<20)){
#         pdf(motifplot_file)
#         plotMB(results = results, rsid = snp, effect = "strong")
#         dev.off()
#         print('made plot')
#     }
#     else{
#       print('too many motifs. skip plot making')
# }
